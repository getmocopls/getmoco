<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <link rel="stylesheet" href="../css/materialize.min.css" />
    <link
      href="https://fonts.googleapis.com/icon?family=Material+Icons"
      rel="stylesheet"
    />

    <link rel="manifest" href="../manifest.json" />
    <link rel="apple-touch-icon" href="../img/icons/apple-touch-icon.png" />
    <link
      rel="shortcut icon"
      href="../img/icons/favicon.ico"
      type="image/x-icon"
    />

    <meta name="apple-mobile-web-app-status-bar" content="004d40" />
    <meta name="theme-color" content="#004d40" />

    <title>Getmoco</title>
  </head>
  <body>
    <!-- * Main-->
    <main class="" style="display: none">
      <!-- ? Nav & Sidenav -->
      <div class="navbar-fixed">
        <nav class="z-depth-0 teal">
          <div class="nav-wrapper container">
            <a href="/pages/admin.html" class="brand-logo hide-on-med-and-down">
              <img
                src="/img/getmoco.png"
                alt="Getmoco"
                style="width: 180px; margin-top: 10px"
              />
            </a>
            <a data-target="sidenav" class="sidenav-trigger">
              <i class="material-icons">menu</i>
            </a>
            <ul id="nav-mobile" class="right hide-on-med-and-down">
              <li class="">
                <a class="" href="/pages/a_sales_report.html"> Sales </a>
              </li>
              <li class="active">
                <a class="" href="/pages/a_orders.html"> Orders </a>
              </li>
              <li>
                <a class="" href="/pages/a_users.html"> Users </a>
              </li>
              <li><div class="divider"></div></li>
              <li>
                <a class="" href="/pages/a_profile.html"> Profile </a>
              </li>
              <li>
                <a class="" href="/pages/a_settings.html"> Matrix </a>
              </li>
              <li>
                <a class="logout">Log out</a>
              </li>
            </ul>
          </div>
        </nav>
      </div>

      <ul id="sidenav" class="sidenav">
        <li>
          <div class="user-view">
            <a href="/pages/a_profile.html">
              <div class="background teal darken-2"></div>
              <img
                class="circle responsive-img user-image"
                src="/img/default-user.jpg"
              />
              <span class="white-text name"></span>
              <span class="white-text email"></span>
            </a>
          </div>
        </li>
        <li><a href="/pages/admin.html">Getmoco</a></li>
        <li><div class="divider"></div></li>
        <li class="">
          <a class="" href="/pages/a_sales_report.html"> Sales </a>
        </li>
        <li class="active">
          <a class="" href="/pages/a_orders.html"> Orders </a>
        </li>
        <li>
          <a class="" href="/pages/a_users.html"> Users </a>
        </li>
        <li>
          <a class="" href="/pages/a_settings.html"> Matrix </a>
        </li>
        <li><a class="waves-effect logout">Log out</a></li>
      </ul>

      <!-- * Content -->
      <div class="container center-align">
        <div class="row">
          <div class="input-field filter-orders-type col s6">
            <select
              class="browser-default"
              onchange="
                document.querySelector('.filter-orders select').value = 'all'; setupAllOrders()
              "
            >
              <!-- <option value="current, created, !=, none, created">
                Booking up
              </option> -->
              <!-- <option value="waiting, waiting, !=, none, waiting">
                Pending
              </option> -->
              <!-- <option value="transac, transac, !=, none, transac">
                On-going
              </option> -->
              <!-- <option value="toPay, shipment, ==, none, orderConfirmed">
                To Ship
              </option>
              <option value="toPay, shipment, !=, none, shipment">
                Shipping
              </option> -->
              <!-- <option value="paid, orderReceived, ==, false, delivered">
                Delivered
              </option>
              <option value="paid, orderReceived, ==, true, received">
                Received
              </option> -->
              <option value="pending, none, none, none, created">
                Pending
              </option>
              <option value="ongoing, none, none, none, transac">
                On-going
              </option>
              <option value="delivered, none, none, none, delivered">
                Delivered
              </option>
            </select>
          </div>
          <div class="input-field filter-orders col s6">
            <select
              class="browser-default"
              onchange="document.querySelector('#date-form').reset(); setupAllOrders()"
            >
              <option value="all">Overall</option>
              <option value="day">Day</option>
              <option value="week">Week</option>
              <option value="month">Month</option>
              <option value="custom">Custom Range</option>
            </select>
          </div>
          <div class="col s12">
            <form id="date-form">
              <div class="day-week-container" style="display: none">
                <label for="day">Select a date:</label>
                <input
                  type="date"
                  id="day"
                  name="day"
                  onchange="setupAllOrders()"
                />
              </div>
              <div class="month-container" style="display: none">
                <label for="month">Select a month:</label>
                <input
                  type="month"
                  id="month"
                  name="month"
                  onchange="setupAllOrders()"
                />
              </div>
              <div class="custom-container row" style="display: none">
                <div class="col s6">
                  <label for="day1">Start Date:</label>
                  <input
                    type="datetime-local"
                    id="day1"
                    name="day1"
                    onchange="setupAllOrders()"
                  />
                </div>
                <div class="col s6">
                  <label for="day2">End Date:</label>
                  <input
                    type="datetime-local"
                    id="day2"
                    name="day2"
                    onchange="setupAllOrders()"
                  />
                </div>
              </div>
            </form>
          </div>
        </div>
        <div>
          <hr />
          <div class="row">
            <div class="col s4">
              <h6><strong class="teal-text">Total Orders:</strong></h6>
              <p><span class="totalOrders">0</span></p>
            </div>
            <div class="col s4">
              <h6>
                <strong class="orange-text">Total Customers:</strong>
              </h6>
              <p><span class="totalCustomers">0</span></p>
            </div>
            <div class="col s4">
              <h6>
                <strong class="red-text">Total Drivers:</strong>
              </h6>
              <p><span class="totalDrivers">0</span></p>
            </div>
          </div>
          <hr />
          <div class="row">
            <div class="col s12">
              <form id="expand_form" class="">
                <div class="switch col s6 m3">
                  <label>
                    Date Expand:
                    <input
                      type="checkbox"
                      name="expand"
                      onchange="setupAllOrders()"
                      disabled
                    />
                    <span class="lever"></span>
                  </label>
                </div>
                <div class="switch col s6 m3 per-driver" style="display: none">
                  <label>
                    Per Driver:
                    <input
                      type="checkbox"
                      name="expand2"
                      onchange="setupAllOrders()"
                      disabled
                    />
                    <span class="lever"></span>
                  </label>
                </div>
              </form>
            </div>
            <div class="col s12">
              <div class="input-field col s12 search">
                <i class="material-icons prefix">search</i>
                <input
                  id="search"
                  type="text"
                  class="validate"
                  onkeyup="searchInTable('#search', '.table-main', 1, 4)"
                />
                <label for="search">Search</label>
              </div>
            </div>
          </div>
          <hr />
          <div id="table-container">
            <table class="responsive-table highlight centered table-main">
              <thead class="table-head">
                <tr>
                  <th>#</th>
                  <th class="">Date</th>
                  <th class="column3">Orders</th>
                  <th class="column4">Customers</th>
                  <th class="column5">Drivers</th>
                </tr>
              </thead>
              <tbody class="table-body">
                <tr>
                  <td>1</td>
                  <td>2</td>
                  <td>3</td>
                  <td>4</td>
                  <td>5</td>
                </tr>
              </tbody>
            </table>
            <br /><br /><br />
          </div>
        </div>
      </div>
    </main>

    <!-- Modal Structure -->
    <div id="view_order_modal" class="modal">
      <div class="modal-content">
        <div class="items-list">
          <br />
          <div class="row">
            <div class="col s12 m4 grey lighten-3">
              <ul class="collapsible">
                <li class="active">
                  <div class="collapsible-header">
                    <i class="material-icons">location_on</i>
                    Location Details
                  </div>
                  <div class="collapsible-body">
                    <h6><strong>Store Location</strong></h6>
                    <p class="addressOrg"></p>
                    <h6><strong>Store Landmark</strong></h6>
                    <p class="landmarkOrg"></p>
                    <hr />
                    <h6><strong>Delivery Address</strong></h6>
                    <p class="addressDrp"></p>
                    <h6><strong>Delivery Landmark</strong></h6>
                    <p class="landmarkDrp"></p>
                  </div>
                </li>
              </ul>
            </div>
            <div class="col s12 m8 teal lighten-3">
              <ul class="collapsible order-items"></ul>
            </div>
          </div>
        </div>
        <div class="payment-user">
          <div class="row">
            <div class="col s12 m8 grey lighten-2 push-m2">
              <div class="card">
                <div class="card-content">
                  <span class="card-title">
                    Order ID: <small><span class="order-id"></span></small>
                  </span>
                  <div class="row">
                    <div class="col s12 m6">
                      <!-- <div class="col s12">
                        <div class="col s6">Total Weight:</div>
                        <div class="col s6">
                          <span class="totalWeight">0</span> kg
                        </div>
                      </div> -->
                      <div class="col s12">
                        <div class="col s6">Total Distance:</div>
                        <div class="col s6">
                          <span class="totalDistance">0</span> km
                        </div>
                      </div>
                    </div>
                    <div class="col s12 m6">
                      <div class="col s12">
                        <div class="col s6">Items Price:</div>
                        <div class="col s6">
                          &#8369;&nbsp;<span class="itemsPrice">0.00</span>
                        </div>
                      </div>
                      <div class="col s12">
                        <div class="col s6">Service Fee:</div>
                        <div class="col s6">
                          &#8369;&nbsp;<span class="serviceFee">0.00</span>
                        </div>
                      </div>
                    </div>
                    <hr class="col s12" />
                    <div class="col s12">
                      <div class="col s6"><strong>Total Price:</strong></div>
                      <div class="col s6">
                        <strong>
                          &#8369;&nbsp;<span class="totalItemsPrice">0.00</span>
                        </strong>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <div class="col s12 m8 push-m2 grey lighten-2">
              <ul class="collapsible">
                <li class="">
                  <div class="collapsible-header">
                    <i class="material-icons">account_box</i>
                    Getmoco Customer
                  </div>
                  <div class="collapsible-body">
                    <div class="col s12 center-align">
                      <div class="col s10 push-s1 m4 push-m4">
                        <img
                          class="circle responsive-img user-image materialboxed"
                          src="/img/default-user.jpg"
                        />
                      </div>
                      <div class="col s12">
                        <h6 class="user-name"></h6>
                      </div>
                    </div>
                    <p>
                      <small class="user-type-label"> Customer ID: </small>
                      <br />
                      <small class="user-id"></small>
                    </p>
                  </div>
                </li>
              </ul>
            </div>
          </div>
        </div>
        <div class="order-status">
          <div class="row">
            <div class="col s12 m8 teal lighten-3 push-m2">
              <div class="card">
                <div class="card-content">
                  <span class="card-title">
                    Order Status: <span class="shipment-status"></span>
                  </span>
                  <h6 class="teal-text">Shipment Time:</h6>
                  <p class="shipment"></p>
                  <h6 class="teal-text">Delivered Time:</h6>
                  <p class="delivered"></p>
                  <h6 class="teal-text">Received Time:</h6>
                  <p class="received"></p>
                  <hr style="display: none" />
                  <div class="center-align" style="display: none">
                    <button
                      class="btn waves-effect waves-light teal receive-button"
                      onclick="//setAsReceived(true, orderID, locationID); this.disabled = 'true'"
                      style="display: none"
                    >
                      Order Received
                    </button>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- ? Loading Screen -->
    <div
      class="loading"
      style="
        position: fixed;
        top: 45%;
        left: 50%;
        transform: translate(-50%, -50%);
      "
    >
      <div class="preloader-wrapper active">
        <div class="spinner-layer spinner-teal-only">
          <div class="circle-clipper left">
            <div class="circle"></div>
          </div>
          <div class="gap-patch">
            <div class="circle"></div>
          </div>
          <div class="circle-clipper right">
            <div class="circle"></div>
          </div>
        </div>
      </div>
    </div>

    <!-- ? Firebase v.8 -->
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-storage.js"></script>
    <script>
      // Your web app's Firebase configuration
      const firebaseConfig = {
        apiKey: "AIzaSyDFXGl864Z-Qq2zzprT9VDZFK9K5iQSPIk",
        authDomain: "getmoco-sca.firebaseapp.com",
        projectId: "getmoco-sca",
        storageBucket: "getmoco-sca.appspot.com",
        messagingSenderId: "351174281270",
        appId: "1:351174281270:web:dad92b8ed2a41eaa583097",
      };
      firebase.initializeApp(firebaseConfig);
      const db = firebase.firestore();
      const auth = firebase.auth();
      const storage = firebase.storage();
      const storageRef = storage.ref();

      db.settings({ timestampsInSnapshots: true });
    </script>
    <script src="../js/app.js"></script>
    <script src="../js/db.js"></script>
    <script src="../js/ui.js"></script>
    <script type="text/javascript" src="../js/materialize.min.js"></script>

    <!-- 
      ! Authentication Status 
    -->
    <script>
      let adminID = "";

      let orderCount;
      let customerCount;
      let driverCount;

      let i = 0; // driver data count
      let j = 0;
      let k = 0;
      let m = 0;
      let n = 0;

      let orders = [];
      let customers = [];
      let drivers = [];
      let customers2 = [];
      let drivers2 = [];

      // * Auth Status
      auth.onAuthStateChanged((user) => {
        //console.log(user);

        if (user) {
          adminID = user.uid;

          // Account Type
          db.collection("getmoco_users")
            .doc(adminID)
            .get()
            .then((doc) => {
              const type = doc.data().type;

              if (type === "user") {
                window.location.href = "/pages/home.html";
              } else if (type === "driver") {
                window.location.href = "/pages/driver.html";
              } else if (type === "admin") {
                setupPageLoading();
                setupMenuUI(user);
                logout();
                setupAllOrders();
                setupViewOrderInfo();
              } else {
                window.location.href = "/pages/error.html";
              }
            });
        } else window.location.href = "/";
      });
    </script>
  </body>
</html>
